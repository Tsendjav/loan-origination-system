# =====================================================================================
# LOS (Loan Origination System) Main Configuration - –≠–¶–°–ò–ô–ù –•–£–í–ò–õ–ë–ê–† (–ó–ê–°–í–ê–†–õ–ê–°–ê–ù)
# =====================================================================================
# Created: 2025-07-26
# Updated: –ë“Æ–†–≠–ù –ó–ê–°–í–ê–†–õ–ê–°–ê–ù - Redis –∞–ª–¥–∞–∞ —à–∏–π–¥—ç–≥–¥—Å—ç–Ω
# =====================================================================================

server:
  port: 8080
  servlet:
    context-path: /los
  compression:
    enabled: true
    mime-types: text/html,text/xml,text/plain,text/css,text/javascript,application/javascript,application/json
  tomcat:
    max-threads: 200
    min-spare-threads: 10

spring:
  application:
    name: loan-origination-system
  
  # Bean definition overriding prevention
  main:
    allow-bean-definition-overriding: false
    lazy-initialization: false

  # ‚≠ê REDIS DISABLE - Redis –∞–ª–¥–∞–∞–≥ —à–∏–π–¥—ç—Ö ‚≠ê
  autoconfigure:
    exclude:
      - org.springframework.boot.autoconfigure.data.redis.RedisAutoConfiguration
      - org.springframework.boot.autoconfigure.data.redis.RedisReactiveAutoConfiguration
      - org.springframework.boot.autoconfigure.data.redis.RedisRepositoriesAutoConfiguration

  # ‚≠ê H2 Database Configuration (Development) - –ó–ê–°–í–ê–†–õ–ê–°–ê–ù ‚≠ê
  datasource:
    url: jdbc:h2:mem:losdb;MODE=PostgreSQL;DATABASE_TO_LOWER=TRUE;NON_KEYWORDS=VALUE
    driver-class-name: org.h2.Driver
    username: sa
    password: ""
    hikari:
      maximum-pool-size: 10
      minimum-idle: 2
      connection-timeout: 30000
      idle-timeout: 600000
      max-lifetime: 1800000

  # H2 Console Configuration
  h2:
    console:
      enabled: true
      path: /h2-console
      settings:
        web-allow-others: true
        trace: false

  # ‚≠ê JPA/Hibernate Configuration - –ó–ê–°–í–ê–†–õ–ê–°–ê–ù ‚≠ê
  jpa:
    hibernate:
      ddl-auto: none  # Schema.sql-–≥ –∞—à–∏–≥–ª–∞—Å–∞–Ω, Hibernate create —Ö–∏–π—Ö–≥“Ø–π
      naming:
        physical-strategy: org.hibernate.boot.model.naming.PhysicalNamingStrategyStandardImpl
        implicit-strategy: org.hibernate.boot.model.naming.ImplicitNamingStrategyLegacyJpaImpl
    show-sql: true
    properties:
      hibernate:
        dialect: org.hibernate.dialect.H2Dialect
        format_sql: true
        use_sql_comments: true
        jdbc:
          time_zone: UTC
          batch_size: 20
          order_inserts: true
          order_updates: true
        connection:
          provider_disables_autocommit: true
        query:
          fail_on_pagination_over_collection_fetch: true
          in_clause_parameter_padding: true
    open-in-view: false
    defer-datasource-initialization: true

  # ‚≠ê SQL Initialization - –ó–ê–°–í–ê–†–õ–ê–°–ê–ù ‚≠ê
  sql:
    init:
      mode: always
      schema-locations: classpath:schema.sql
      data-locations: classpath:data.sql
      continue-on-error: false
      encoding: UTF-8

  # Disable Flyway for H2 database
  flyway:
    enabled: false

  # File Upload Configuration
  servlet:
    multipart:
      max-file-size: 10MB
      max-request-size: 10MB
      enabled: true

  # JSON Configuration
  jackson:
    serialization:
      write-dates-as-timestamps: false
      indent-output: true
    deserialization:
      fail-on-unknown-properties: false
    default-property-inclusion: NON_NULL
    time-zone: UTC
    date-format: yyyy-MM-dd HH:mm:ss

  # ‚≠ê Cache Configuration - In-Memory Cache ‚≠ê
  cache:
    type: simple  # Redis-–∏–π–Ω –æ—Ä–æ–Ω–¥ in-memory cache
    cache-names: 
      - customers
      - loan-applications
      - documents
      - userCache
      - authCache

  # Transaction Configuration
  transaction:
    default-timeout: 30
    rollback-on-commit-failure: true

# ‚≠ê Management/Actuator Configuration - Redis Health Disabled ‚≠ê
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus,env,beans
      base-path: /actuator
  endpoint:
    health:
      show-details: always
      probes:
        enabled: true
  health:
    diskspace:
      enabled: true
    db:
      enabled: true
    redis:
      enabled: false  # ‚≠ê Redis health check DISABLED ‚≠ê
  metrics:
    export:
      prometheus:
        enabled: false

# Logging Configuration
logging:
  level:
    root: INFO
    com.company.los: DEBUG
    org.springframework.web: INFO
    org.springframework.security: INFO
    org.hibernate.SQL: DEBUG
    org.hibernate.type.descriptor.sql.BasicBinder: TRACE
    org.springframework.transaction: DEBUG
    # ‚≠ê Redis log-—É—É–¥—ã–≥ suppress —Ö–∏–π—Ö ‚≠ê
    org.springframework.boot.autoconfigure.data.redis: ERROR
    org.springframework.data.redis: ERROR
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"
    file: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"
  file:
    name: logs/los-application.log
    max-size: 10MB
    max-history: 30

# Springdoc OpenAPI Configuration
springdoc:
  api-docs:
    path: /api-docs
    enabled: true
  swagger-ui:
    path: /swagger-ui.html
    display-request-duration: true
    tags-sorter: alpha
    operations-sorter: alpha
    doc-expansion: none
  show-actuator: true

# Application Specific Configuration
app:
  name: "Loan Origination System"
  version: "1.0.0"
  description: "LOS - –ó—ç—ç–ª–∏–π–Ω —Ö“Ø—Å—ç–ª—Ç–∏–π–Ω —Ü–æ–≥—Ü —Å–∏—Å—Ç–µ–º"
  
  # ‚≠ê JWT Configuration - –®–∏–ª–∂“Ø“Ø–ª—Å—ç–Ω ‚≠ê
  jwt:
    secret: myVerySecretKeyThatIsAtLeast32CharactersLong
    expiration: 86400000  # 24 hours
    refresh-expiration: 604800000  # 7 days
    issuer: loan-origination-system
  
  # Security Configuration
  security:
    cors:
      allowed-origins: "http://localhost:3001,http://localhost:3000,http://127.0.0.1:3001,http://127.0.0.1:3000"
      allowed-methods: "GET,POST,PUT,DELETE,OPTIONS,PATCH"
      allowed-headers: "*"
      allow-credentials: true
      max-age: 3600
    
    # Rate limiting (Redis-–≥“Ø–π–≥—ç—ç—Ä disabled)
    rate-limit:
      enabled: false  # ‚≠ê Redis –±–∞–π—Ö–≥“Ø–π —É—á–∏—Ä rate limiting disabled ‚≠ê
      requests-per-minute: 60
      
  # Document Configuration
  document:
    storage:
      path: "./uploads/documents"
    max-size: 52428800  # 50MB
    allowed-types:
      - "application/pdf"
      - "image/jpeg" 
      - "image/png"
      - "application/msword"
      - "application/vnd.openxmlformats-officedocument.wordprocessingml.document"
      - "application/vnd.ms-excel"
      - "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"
    
    # OCR Configuration
    ocr:
      enabled: false
      confidence-threshold: 0.8
      
  # Loan Business Rules
  loan:
    max-amount: 1000000000  # 1 billion MNT
    min-amount: 100000      # 100k MNT
    max-term-months: 360    # 30 years
    min-term-months: 6      # 6 months
    
    # Auto approval rules
    auto-approval:
      enabled: true
      max-amount: 10000000   # 10M MNT
      max-term-months: 60    # 5 years
      min-credit-score: 650
      
    # Interest rates
    interest-rates:
      personal-loan: 18.5
      mortgage: 12.0
      business-loan: 15.0
      car-loan: 14.5
      
  # Notification Configuration
  notification:
    email:
      enabled: false
      smtp:
        host: localhost
        port: 1025
        username: ""
        password: ""
        auth: false
        starttls: false
    sms:
      enabled: false
      provider: "twilio"
      api-key: ""
      from-number: ""

---
# Production Profile Configuration
spring:
  config:
    activate:
      on-profile: prod
      
  # PostgreSQL Database for Production
  datasource:
    url: jdbc:postgresql://localhost:5432/los_db
    username: ${DB_USERNAME:los_user}
    password: ${DB_PASSWORD:los_password}
    driver-class-name: org.postgresql.Driver
    hikari:
      maximum-pool-size: 20
      minimum-idle: 5
      idle-timeout: 300000
      max-lifetime: 600000
      connection-timeout: 30000
      leak-detection-threshold: 60000
      
  # Disable H2 Console in Production
  h2:
    console:
      enabled: false
      
  # Production JPA Configuration
  jpa:
    hibernate:
      ddl-auto: validate
    show-sql: false
    properties:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect
        jdbc:
          batch_size: 25
        connection:
          provider_disables_autocommit: true
        
  # Production SQL Configuration
  sql:
    init:
      mode: never  # Don't run schema.sql and data.sql in production
      
  # Enable Flyway for Production
  flyway:
    enabled: true
    baseline-on-migrate: true
    validate-on-migrate: true
    locations: classpath:db/migration
    baseline-version: 0
    baseline-description: "Initial version"

# Production Logging
logging:
  level:
    root: WARN
    com.company.los: INFO
    org.springframework.web: WARN
    org.springframework.security: WARN
    org.hibernate.SQL: WARN
  file:
    name: /var/log/los/loan-origination-system.log
    max-size: 50MB
    max-history: 90

# Production Application Configuration
app:
  jwt:
    secret: ${JWT_SECRET:myVerySecretKeyThatIsAtLeast32CharactersLong}
    expiration: ${JWT_EXPIRATION:86400000}
    refresh-expiration: ${JWT_REFRESH_EXPIRATION:604800000}
  security:
    cors:
      allowed-origins: ${ALLOWED_ORIGINS:https://los.company.com}
  notification:
    email:
      enabled: true
      smtp:
        host: ${SMTP_HOST:smtp.company.com}
        port: ${SMTP_PORT:587}
        username: ${SMTP_USERNAME}
        password: ${SMTP_PASSWORD}
        auth: true
        starttls: true

---
# Test Profile Configuration
spring:
  config:
    activate:
      on-profile: test
      
  # H2 Database for Testing
  datasource:
    url: jdbc:h2:mem:testdb;MODE=PostgreSQL;DATABASE_TO_LOWER=TRUE
    driver-class-name: org.h2.Driver
    username: sa
    password: ""
    
  # Disable H2 Console for Tests
  h2:
    console:
      enabled: false
      
  # Test JPA Configuration
  jpa:
    hibernate:
      ddl-auto: create-drop
    show-sql: false
    
  # Test SQL Configuration
  sql:
    init:
      mode: never  # Let Hibernate create schema for tests
      
  # Disable Flyway for Tests
  flyway:
    enabled: false

  # ‚≠ê Test –¥—ç—ç—Ä —á Redis disable ‚≠ê
  autoconfigure:
    exclude:
      - org.springframework.boot.autoconfigure.data.redis.RedisAutoConfiguration
      - org.springframework.boot.autoconfigure.data.redis.RedisReactiveAutoConfiguration

# Test Logging Configuration
logging:
  level:
    root: WARN
    com.company.los: DEBUG
    org.springframework.web: WARN
    org.hibernate.SQL: WARN
    
# Test Application Configuration
app:
  jwt:
    secret: testSecretKeyThatIsAtLeast32CharactersLong
    expiration: 3600000  # 1 hour for tests
    refresh-expiration: 7200000  # 2 hours for tests
  notification:
    email:
      enabled: false
    sms:
      enabled: false

# =====================================================================================
# ‚≠ê –≠–¶–°–ò–ô–ù –•–£–í–ò–õ–ë–ê–† - REDIS –ê–õ–î–ê–ê –ë“Æ–†–≠–ù –®–ò–ô–î–≠–ì–î–°–≠–ù ‚≠ê
# =====================================================================================
# üåê URLs:
#    Backend:     http://localhost:8080/los
#    H2 Console:  http://localhost:8080/los/h2-console
#    API Docs:    http://localhost:8080/los/swagger-ui.html
#    Frontend:    http://localhost:3001
#
# üîë LOGIN CREDENTIALS:
#    admin / admin123 (Super Admin)
#    loan_officer / loan123 (–ó—ç—ç–ª–∏–π–Ω –º—ç—Ä–≥—ç–∂–∏–ª—Ç—ç–Ω)
#    manager / manager123 (–ú–µ–Ω–µ–∂–µ—Ä)
#
# üóÑÔ∏è H2 Database:
#    JDBC URL: jdbc:h2:mem:losdb
#    Username: sa
#    Password: (—Ö–æ–æ—Å–æ–Ω)
#
# ‚≠ê –®–ò–ô–î–≠–ì–î–°–≠–ù –ê–°–£–£–î–õ–£–£–î:
#    ‚úÖ Redis connection –∞–ª–¥–∞–∞ - DISABLED
#    ‚úÖ In-memory cache –∞—à–∏–≥–ª–∞–Ω–∞
#    ‚úÖ Redis health check disabled
#    ‚úÖ Rate limiting disabled (Redis dependency –±–∞–π—Ö–≥“Ø–π —É—á–∏—Ä)
#    ‚úÖ Logging Redis errors suppressed
# =====================================================================================